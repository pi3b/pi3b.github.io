# StateManager介绍
![avatar](_media/favicon.ico)

> StateManager是专为上位机开发人员设计的，用于工业智能化开发的状态机框架

## StateManager用来解决什么？
我们先了解一下工业控制领域的层次结构：
- L0：现场设备、传感器，例如电机、伺服、光电开关等
- **L1：现场过程控制，例如PLC、嵌入式控制器、DCS等**
- **L2：系统监控，例如SCADA、DCS、物联网等**
- L3：生产综合管理，例如MES
- L4：企业经营管理，例如ERP

这里我们关注的是L1/L2，实际上这两个层次并没有明确分界，都有“控”的内容，而L2更重于系统、业务层面的信号控制、监视。

拿PLC来说，它主要完成L1层控制内容，但同时配合HMI等人机界面可以完成L2层的监控内容。SCADA主要完成L2层监视内容，也可以根据不同的业务需求选择产生L1层的动作指令。

L1层侧重于完成底层的、基本的信号判断和动作执行，L2层侧重于完成设备工作状态、工序、配方、批次等系统和业务相关信号的监视，以及业务相关动作指令的产生。

典型的L1+L2结构就是PLC+上位机(SCADA、DCS或其他PC工控软件)，前者负责现场元件，后者负责对接生产业务，业务越复杂、控制越精细，上位机内容就越多，反之PLC内容就越多。

当然非业务内容也可以做在上位机，典型的应用就是使用基于工业PC的接口控制卡、DCS等，不用PLC，在上位机软件层面处理所有控制逻辑。

如果说PLC是做非标的一把菜刀，那么上位机就是做标准化肉块的切肉机，优势很明显，省厨师。

**StateManager可用于实现L1/L2涵盖的所有功能，可用于SCADA、DCS、（使用了PCI等接口控制卡件的）工业PC、物联网等所有基于PC的上位机程序。**

## StateManager的特点
1. 参考了PLC扫描周期的原理，实现了毫秒级扫描周期。
2. 手自一体，手动操作界面上的按钮可用于自动逻辑时调用，避免了代码重复，也使自动业务的理解变的简洁、高效。
3. 将业务按工位对象划分或拆分，并表达为一个个状态图，再将状态图编写为C#状态处理函数（或JS/VBS脚本函数），即可实现任意复杂逻辑。
4. 对第三方组件全面支持，也可开发基于本框架的组件。
5. 借鉴了WINCC的连接管理及信号采集机制，并优化为主动、按需、同步、直接从设备采集，降低了数据流量的同时提高了数据实时性，也可灵活运用为周期采集。

## StateManager的由来

自2009年开始，作者就开始接触WINCC、组态王、MCGS、INTOUCH、LabView等DCS和SCADA上位机软件，他们通用性强，功能细化至界面的拖拽、通讯点位的下拉配置等，对于缺乏编程基础的开发人员来说，上手快，方便快捷。

而近些年来，对于模块化装备为主的自动化工厂，上位机软件工程师需要应对的设备五花八门，非标准协议等特殊情况非常之多，例如对接各种PLC、对接MES/ERP、对BCR进行通讯控制、刻字机的数据交换、机器人的通讯、图像拍照分析等等，传统工具软件虽然有着脚本系统及插件扩展，却很难做到全面，而且难以利用丰富的三方资源。遇到特殊问题时经常连厂商自己也不能给出满意的方案，毕竟厂商专注的是通用性，而我们都会遇到自己的特殊情况。

作者认为，在数字化、智能化工厂成为主流的今天，__高级编程语言几乎已经成为了自动化技术人员的标配技能__！丰富的开源社区以及技术交流平台，已经足够我们轻松的实现读写数据库、读写PLC、TCP收发数据、画面显示等等..

我们希望将更多的精力专注于业务逻辑、节拍、时序，而并非线程管理、异常处理等必须小心编写的代码。

我们需要的是类似于组态软件的一种稳定的代码执行框架，又能灵活到可以按照我们自己编写的业务逻辑条件执行任意功能，这些功能来自我们自己编写的代码，让我们可以顺利的使用第三方资源!

这也是StateManager的由来，一个可以个性化定制开发的、高弹性的、轻量级的状态机框架。

然而SateManager的目标更加远大，她的使命绝不局限于此，作者将沥血雕琢其成为解决逻辑难题的万能解决方案！

